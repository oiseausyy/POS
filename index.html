<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‡πÄ‡∏Å‡∏°‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏µ‡∏ß‡∏á‡πÄ‡∏´‡∏•‡πâ‡∏≤ ‚Äî Board Drinking Game</title>
<style>
  :root{
    --board-bg: #f7efe5;
    --tile-bg: #fff9f0;
    --accent: #8b5e3c;
    --muted: #777;
    --token-size: 28px;
  }
  body{
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Arial;
    margin: 12px;
    background: linear-gradient(180deg,#f0e9e0 0%, #efe6db 100%);
    color:#2b2b2b;
  }
  header{
    display:flex;
    gap:12px;
    align-items:center;
    margin-bottom:12px;
  }
  header h1{
    margin:0;
    font-size:20px;
    color:var(--accent);
  }
  .controls{
    display:flex;
    gap:8px;
    align-items:center;
    margin-bottom:12px;
    flex-wrap:wrap;
  }
  input[type="text"]{ padding:6px 8px; border-radius:6px; border:1px solid #d0c6bd; }
  button{
    background:var(--accent);
    color:white;
    border:0;
    padding:8px 10px;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
  }
  button.secondary{ background:#d8c7b4; color:#3b2b21; }
  .board-wrap{ display:flex; gap:12px; align-items:flex-start; flex-wrap:wrap; }
  .board{
    width:680px;
    height:520px;
    background:var(--board-bg);
    border:8px solid #c9b79f;
    border-radius:12px;
    padding:12px;
    box-sizing:border-box;
    display:grid;
    grid-template-columns: repeat(11, 1fr);
    grid-template-rows: repeat(7, 1fr);
    gap:6px;
  }
  /* We'll place tiles using specific grid positions */
  .tile{
    background:var(--tile-bg);
    border-radius:8px;
    box-shadow: 0 1px 0 rgba(0,0,0,0.06);
    border:1px solid rgba(0,0,0,0.04);
    padding:6px;
    font-size:12px;
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    position:relative;
    overflow:hidden;
  }
  .tile .title{ font-weight:700; color:var(--accent); font-size:12px; }
  .tile .desc{ font-size:11px; color:var(--muted); margin-top:4px; }
  /* tokens */
  .token{
    position:absolute;
    width:var(--token-size);
    height:var(--token-size);
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    color:white;
    font-size:12px;
    font-weight:700;
    transform: translate(-10px, -10px);
    box-shadow:0 2px 6px rgba(0,0,0,0.2);
    border:2px solid rgba(255,255,255,0.6);
  }
  /* side panel */
  .sidebar{
    min-width:260px;
    max-width:320px;
    background:linear-gradient(180deg,#fffdf9,#f7f0e8);
    padding:12px;
    border-radius:12px;
    border:1px solid #e2d8cc;
    box-shadow:0 6px 20px rgba(0,0,0,0.06);
  }
  .players-list{ display:flex; flex-direction:column; gap:8px; margin-bottom:10px; }
  .player{
    display:flex;
    gap:8px;
    align-items:center;
    justify-content:space-between;
    padding:8px;
    border-radius:8px;
    background: #fff;
    border:1px solid #efe7de;
  }
  .player .left{ display:flex; gap:8px; align-items:center; }
  .player .dot{ width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-weight:700;}
  .status{ font-size:13px; color:var(--muted); }
  .big-dice{
    width:120px;
    height:120px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:40px;
    background:#fff;
    border-radius:12px;
    border:1px solid #e7ded2;
    margin-bottom:12px;
  }
  .log{ height:130px; overflow:auto; border-radius:8px; padding:8px; background:#fff8f2; border:1px dashed #efdcc7; font-size:13px; }
  footer{ margin-top:12px; font-size:13px; color:var(--muted); }
  /* modal */
  .modal{
    position:fixed;
    inset:0;
    background: rgba(0,0,0,0.45);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:999;
  }
  .modal.open{ display:flex; }
  .modal .card{
    width:540px;
    max-width:96%;
    background:white;
    padding:18px;
    border-radius:12px;
    box-shadow:0 20px 60px rgba(0,0,0,0.4);
  }
  .muted-small{ font-size:12px; color:var(--muted); }
  .small{ font-size:12px; }
  .chip{ display:inline-block; padding:6px 8px; background:#f2e9e0; border-radius:999px; font-weight:700; color:var(--accent); margin-right:6px; }
  .center{ text-align:center; }
  @media (max-width:980px){
    .board{ width:100%; height:420px; grid-template-columns: repeat(9,1fr); grid-template-rows: repeat(7, 1fr); }
    .board-wrap{ flex-direction:column; align-items:stretch; }
  }
</style>
</head>
<body>
<header>
  <h1>üé≤ ‡πÄ‡∏Å‡∏°‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏µ‡∏ß‡∏á‡πÄ‡∏´‡∏•‡πâ‡∏≤ (Board Drinking Game)</h1>
  <div class="muted-small">‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ß‡πá‡∏ö ‚Äî ‡πÄ‡∏ã‡∏ü‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</div>
</header>

<div class="controls">
  <label class="small">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ , )</label>
  <input id="playerNames" type="text" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏ï‡∏±‡πâ‡∏°, ‡∏°‡∏≤‡∏£‡πå‡∏Ñ, ‡∏´‡∏°‡∏µ" style="min-width:280px">
  <button id="btnStart">Start Game</button>
  <button id="btnReset" class="secondary">Reset</button>
  <button id="btnRules" class="secondary">‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</button>
</div>

<div class="board-wrap">
  <div class="board" id="board" aria-label="game board">
    <!-- Tiles - will be injected by JS -->
  </div>

  <aside class="sidebar">
    <div class="center">
      <div class="chip">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</div>
    </div>

    <div class="players-list" id="playersList">
      <!-- player cards -->
    </div>

    <div class="center">
      <div class="big-dice" id="diceDisplay">‚Äî</div>
    </div>

    <div style="display:flex; gap:8px; margin-bottom:8px;">
      <button id="btnRoll">Roll Dice</button>
      <button id="btnEnd" class="secondary">End Turn</button>
      <button id="btnDraw" class="secondary">Draw Card</button>
    </div>

    <div class="log" id="log"></div>

    <div style="margin-top:10px;">
      <div class="muted-small">‡∏ä‡πá‡∏≠‡∏ï‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏î‡∏∑‡πà‡∏° ‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° "‡πÑ‡∏°‡πà‡∏î‡∏∑‡πà‡∏°" ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå</div>
    </div>
  </aside>
</div>

<footer>
  ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö ‚Ä¢ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏ó‡∏ô‡∏ä‡πá‡∏≠‡∏ï‡∏î‡πâ‡∏ß‡∏¢ "‡∏á‡∏≤‡∏ô‡∏ó‡πâ‡∏≤" ‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡∏Å‡∏•‡∏á‡πÉ‡∏ô‡∏ß‡∏á
</footer>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="card" id="modalCard">
    <div id="modalTitle" style="font-weight:800; font-size:18px;"></div>
    <p id="modalText" style="margin-top:8px;"></p>
    <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
      <button id="modalConfirm">‡πÇ‡∏≠‡πÄ‡∏Ñ (‡∏¢‡∏≠‡∏°‡∏î‡∏∑‡πà‡∏°)</button>
      <button id="modalSkip" class="secondary">‡πÑ‡∏°‡πà‡∏î‡∏∑‡πà‡∏° / ‡∏Ç‡πâ‡∏≤‡∏°</button>
    </div>
  </div>
</div>

<script>
/*
  Game data & logic
*/
const PLAYER_COLORS = ['#e74c3c','#3498db','#f39c12','#8e44ad','#27ae60','#d35400'];
const TILE_COUNT = 30;

// preset tiles (30) - type: drink (n shots), event (instructions), safe
const TILES = [
  {title:'Start', desc:'‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° ‚Äî ‡∏ä‡∏ô‡πÅ‡∏Å‡πâ‡∏ß‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏£‡∏ö‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏£‡∏≠‡∏ö', type:'safe'},
  {title:'‡∏î‡∏∑‡πà‡∏° 1', desc:'‡∏î‡∏∑‡πà‡∏° 1 ‡∏ä‡πá‡∏≠‡∏ï', type:'drink', value:1},
  {title:'‡∏Å‡∏•‡πâ‡∏≤-‡πÑ‡∏°‡πà‡∏Å‡∏•‡πâ‡∏≤', desc:'‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ñ‡∏≤‡∏° ‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≠‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏∑‡πà‡∏° 2', type:'dare', value:2},
  {title:'‡∏™‡∏•‡∏±‡∏ö‡∏ó‡∏µ‡πà', desc:'‡∏™‡∏•‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å', type:'event'},
  {title:'‡∏Å‡∏≤‡∏£‡πå‡∏î', desc:'‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', type:'card'},
  {title:'‡∏î‡∏∑‡πà‡∏° 2', desc:'‡∏î‡∏∑‡πà‡∏° 2 ‡∏ä‡πá‡∏≠‡∏ï', type:'drink', value:2},
  {title:'‡∏û‡∏±‡∏Å', desc:'‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ', type:'safe'},
  {title:'‡∏Ñ‡∏¥‡∏á', desc:'‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏¥‡∏á 1 ‡∏£‡∏≠‡∏ö (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏Ñ‡∏£‡∏î‡∏∑‡πà‡∏° 1 ‡∏ä‡πá‡∏≠‡∏ï)', type:'king'},
  {title:'‡∏ñ‡∏≠‡∏¢ 2', desc:'‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á 2 ‡∏ä‡πà‡∏≠‡∏á', type:'move', value:-2},
  {title:'‡πÄ‡∏•‡πà‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏≤‡∏¢', desc:'‡πÄ‡∏•‡πà‡∏≤ ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏•‡πà‡∏≤‡∏î‡∏∑‡πà‡∏° 1', type:'dare', value:1},

  {title:'‡∏î‡∏∑‡πà‡∏° 1', desc:'‡∏î‡∏∑‡πà‡∏° 1 ‡∏ä‡πá‡∏≠‡∏ï', type:'drink', value:1},
  {title:'‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á', desc:'‡∏£‡πâ‡∏≠‡∏á‡∏ó‡πà‡∏≠‡∏ô‡∏Æ‡∏¥‡∏ï ‡∏ñ‡πâ‡∏≤‡πÄ‡∏û‡∏µ‡πâ‡∏¢‡∏ô ‡∏î‡∏∑‡πà‡∏° 1', type:'dare', value:1},
  {title:'‡∏Å‡∏≤‡∏£‡πå‡∏î', desc:'‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', type:'card'},
  {title:'‡∏™‡∏•‡∏±‡∏ö‡∏ä‡πá‡∏≠‡∏ï', desc:'‡∏™‡πà‡∏á‡∏ä‡πá‡∏≠‡∏ï 1 ‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢', type:'transfer', value:1},
  {title:'‡∏î‡∏∑‡πà‡∏° 3', desc:'‡∏î‡∏∑‡πà‡∏° 3 ‡∏ä‡πá‡∏≠‡∏ï', type:'drink', value:3},
  {title:'‡∏û‡∏±‡∏Å', desc:'‡∏û‡∏±‡∏Å (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°)', type:'safe'},
  {title:'‡∏ó‡∏≠‡∏¢‡∏ã‡πâ‡∏≥', desc:'‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', type:'roll_again'},
  {title:'‡πÅ‡∏à‡∏Å‡πÇ‡∏à‡∏ó‡∏¢‡πå', desc:'‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Å‡∏•‡πâ‡∏≤-‡πÑ‡∏°‡πà‡∏Å‡∏•‡πâ‡∏≤  ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö ‡∏î‡∏∑‡πà‡∏° 2', type:'dare', value:2},
  {title:'‡∏ñ‡∏≠‡∏¢ 3', desc:'‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á 3 ‡∏ä‡πà‡∏≠‡∏á', type:'move', value:-3},
  {title:'‡∏Å‡∏≤‡∏£‡πå‡∏î', desc:'‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', type:'card'},

  {title:'Double', desc:'‡∏ó‡∏≠‡∏¢‡πÑ‡∏î‡πâ‡∏Ñ‡∏π‡πà ‡∏î‡∏∑‡πà‡∏° 2 ‡∏ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏Ñ‡∏µ‡πà ‡πÅ‡∏à‡∏Å 2', type:'dice_event'},
  {title:'‡∏î‡∏∑‡πà‡∏° 1', desc:'‡∏î‡∏∑‡πà‡∏° 1 ‡∏ä‡πá‡∏≠‡∏ï', type:'drink', value:1},
  {title:'‡∏Ñ‡∏¥‡∏á', desc:'‡∏Ñ‡∏¥‡∏á (‡∏™‡∏±‡πà‡∏á‡πÉ‡∏Ñ‡∏£ 1 ‡∏ä‡πá‡∏≠‡∏ï)', type:'king'},
  {title:'‡∏™‡∏•‡∏±‡∏ö‡∏ó‡∏µ‡πà', desc:'‡∏™‡∏•‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ', type:'event'},
  {title:'‡∏Å‡∏≤‡∏£‡πå‡∏î', desc:'‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', type:'card'},
  {title:'‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πä‡∏Å', desc:'‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏õ‡πä‡∏Å ‡∏´‡∏≤‡∏Å‡πÅ‡∏û‡πâ ‡∏î‡∏∑‡πà‡∏° 1', type:'mini_game'},
  {title:'‡∏û‡∏±‡∏Å', desc:'‡∏û‡∏±‡∏Å (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°)', type:'safe'},
  {title:'‡∏î‡∏∑‡πà‡∏° 2', desc:'‡∏î‡∏∑‡πà‡∏° 2 ‡∏ä‡πá‡∏≠‡∏ï', type:'drink', value:2},
  {title:'Finish', desc:'‡∏Ñ‡∏£‡∏ö 1 ‡∏£‡∏≠‡∏ö ‚Äî ‡∏ä‡∏ô‡πÅ‡∏Å‡πâ‡∏ß‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô 1 ‡∏ä‡πá‡∏≠‡∏ï', type:'finish'}
];

// sample cards deck
const CARDS = [
  {title:'‡πÅ‡∏à‡∏Å‡∏ä‡πá‡∏≠‡∏ï‡∏£‡∏ß‡∏°', text:'‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏ß‡∏á‡∏î‡∏∑‡πà‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô 1 ‡∏ä‡πá‡∏≠‡∏ï', action: (g, idx)=> { g.players.forEach(p=>p.shots += 1); return `${g.currentPlayer().name} ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πå‡∏î: ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏î‡∏∑‡πà‡∏° 1 ‡∏ä‡πá‡∏≠‡∏ï`; }},
  {title:'‡∏ä‡πá‡∏≠‡∏ï‡πÇ‡∏ä‡∏Ñ‡∏£‡πâ‡∏≤‡∏¢', text:'‡∏™‡πà‡∏á‡∏ä‡πá‡∏≠‡∏ï 2 ‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢', action: (g, idx)=> { let i=(idx+1)%g.players.length; g.players[i].shots += 2; return `${g.currentPlayer().name} ‡∏™‡πà‡∏á‡∏ä‡πá‡∏≠‡∏ï 2 ‡πÉ‡∏´‡πâ ${g.players[i].name}`; }},
  {title:'‡∏û‡∏π‡∏î‡∏™‡∏≥‡πÄ‡∏ô‡∏µ‡∏¢‡∏á', text:'‡∏û‡∏π‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏≥‡πÄ‡∏ô‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ñ‡∏∂‡∏á‡∏ï‡∏≤‡∏ñ‡∏±‡∏î‡πÑ‡∏õ', action: (g, idx)=> { return `${g.currentPlayer().name} ‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏π‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏≥‡πÄ‡∏ô‡∏µ‡∏¢‡∏á‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ`; }},
  {title:'‡πÄ‡∏Å‡∏°‡πÄ‡∏õ‡πà‡∏≤‡∏¢‡∏¥‡πâ‡∏á‡∏â‡∏∏‡∏ö', text:'‡∏ä‡∏ô‡∏∞ ‚Üí ‡πÅ‡∏à‡∏Å 2 ‡∏ä‡πá‡∏≠‡∏ï‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏û‡πâ ‚Üí ‡∏î‡∏∑‡πà‡∏° 2', action: (g, idx)=> { return `${g.currentPlayer().name} ‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î: ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏õ‡πà‡∏≤‡∏¢‡∏¥‡πâ‡∏á‡∏â‡∏∏‡∏ö‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏Ñ‡∏ô‡πÅ‡∏û‡πâ‡∏î‡∏∑‡πà‡∏° 2`; }},
  {title:'‡∏á‡∏≤‡∏ô‡∏ó‡πâ‡∏≤', text:'‡∏ï‡∏±‡πâ‡∏á‡∏ó‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô 1 ‡∏≠‡∏¢‡πà‡∏≤‡∏á (‡πÅ‡∏ó‡∏ô‡∏î‡∏∑‡πà‡∏°)', action: (g, idx)=> { return `${g.currentPlayer().name} ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡πâ‡∏≤ 1 ‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∑‡πà‡∏°`; }},
  {title:'‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ', text:'‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏•‡πà ‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏´‡πâ‡∏î‡∏∑‡πà‡∏° 1', action: (g, idx)=> { return `${g.currentPlayer().name} ‡πÑ‡∏î‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏î‡∏∑‡πà‡∏° 1 ‡∏ä‡πá‡∏≠‡∏ï`; }},
  {title:'‡∏ö‡∏π‡∏™‡∏ï‡πå', text:'‡∏•‡∏î‡∏ä‡πá‡∏≠‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á 1 (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏ñ‡πâ‡∏≤‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 1)', action: (g, idx)=> { if(g.currentPlayer().shots>0) g.currentPlayer().shots -= 1; return `${g.currentPlayer().name} ‡πÉ‡∏ä‡πâ‡∏ö‡∏π‡∏™‡∏ï‡πå ‡∏•‡∏î‡∏ä‡πá‡∏≠‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á 1`; }}
];

// game state
let game = {
  players: [],
  turnIndex: 0,
  dice: 1,
  isStarted: false,
  deck: [],
  logs: [],
  positions: [], // index in tiles
  pendingRoll: false,
  kingIndex: null
};

// helpers
function $(id){ return document.getElementById(id); }
function log(msg){
  game.logs.unshift(`${new Date().toLocaleTimeString()} ‚Äî ${msg}`);
  updateLog();
}
function updateLog(){
  const el = $('log');
  el.innerHTML = game.logs.slice(0,200).map(l=>`<div>${l}</div>`).join('');
}
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}
function startGameFromNames(names){
  const nlist = names.split(',').map(s=>s.trim()).filter(Boolean).slice(0,6);
  if(nlist.length < 2){ alert('‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏Ñ‡∏ô'); return; }
  game.players = nlist.map((name,i)=>({name, color:PLAYER_COLORS[i%PLAYER_COLORS.length], shots:0, rounds:0}));
  game.turnIndex = 0;
  game.positions = new Array(game.players.length).fill(0);
  game.deck = shuffle([...CARDS]);
  game.logs = [];
  game.isStarted = true;
  game.kingIndex = null;
  updateAll();
  renderBoard();
  log(`‡πÄ‡∏Å‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°: ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô ${nlist.join(' / ')}`);
}
function resetGame(){
  game = {
    players: [],
    turnIndex: 0,
    dice: 1,
    isStarted: false,
    deck: [],
    logs: [],
    positions: [],
    pendingRoll:false,
    kingIndex:null
  };
  $('playerNames').value = '';
  renderBoard();
  updateAll();
}

/* UI rendering */
function renderBoard(){
  const b = $('board');
  b.innerHTML = '';
  // We'll place tiles roughly around edges (simple layout)
  // For simplicity we create a 11x7 grid and place tiles in sequence around border-ish
  // But easier: render tiles left-to-right top-to-bottom; show index
  for(let i=0;i<TILE_COUNT;i++){
    const t = TILES[i] || {title:`T${i}`, desc:'', type:'safe'};
    const div = document.createElement('div');
    div.className = 'tile';
    div.dataset.index = i;
    div.innerHTML = `<div>
      <div class="title">${i+1}. ${t.title}</div>
      <div class="desc">${t.desc}</div>
    </div>
    <div style="text-align:right; font-size:11px; color:var(--muted)">${t.type==='drink' && t.value? t.value+' ‡∏ä‡πá‡∏≠‡∏ï':''}</div>`;
    b.appendChild(div);
  }
  // render tokens on top
  placeAllTokens();
}

function placeAllTokens(){
  // remove old tokens
  document.querySelectorAll('.token').forEach(e=>e.remove());
  game.players.forEach((p, pi)=>{
    const pos = game.positions[pi] ?? 0;
    const tileEl = document.querySelector(`.tile[data-index="${pos}"]`);
    if(!tileEl) return;
    const token = document.createElement('div');
    token.className = 'token';
    token.style.left = '10px';
    token.style.top = `${10 + pi*18}px`;
    token.style.background = p.color;
    token.textContent = (pi+1);
    token.title = p.name;
    tileEl.appendChild(token);
  });
}

function updatePlayersList(){
  const box = $('playersList');
  box.innerHTML = '';
  game.players.forEach((p, i)=>{
    const el = document.createElement('div');
    el.className = 'player';
    el.innerHTML = `<div class="left">
      <div class="dot" style="background:${p.color}">${i+1}</div>
      <div>
        <div style="font-weight:700">${p.name}</div>
        <div class="status">‡∏ä‡πá‡∏≠‡∏ï: <strong id="shots-${i}">${p.shots}</strong></div>
      </div>
    </div>
    <div style="text-align:right;">
      <div style="font-size:12px;color:var(--muted)">‡∏£‡∏≠‡∏ö: ${p.rounds}</div>
      <div style="margin-top:6px;">${i===game.turnIndex ? '<div style="color:var(--accent); font-weight:800">‚Üí ‡∏ï‡∏≤‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</div>' : ''}</div>
    </div>`;
    box.appendChild(el);
  });
}

function updateDiceDisplay(val){
  $('diceDisplay').textContent = val === null ? '‚Äî' : val;
}

function updateAll(){
  updatePlayersList();
  updateDiceDisplay(null);
  updateLog();
  placeAllTokens();
}

/* Game mechanics */
function currentPlayerIndex(){ return game.turnIndex; }
function currentPlayer(){ return game.players[game.turnIndex]; }

function rollDice(){
  if(!game.isStarted) { alert('‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏Å‡πà‡∏≠‡∏ô'); return; }
  const val = Math.floor(Math.random()*6) + 1;
  game.dice = val;
  updateDiceDisplay(val);
  log(`${currentPlayer().name} ‡∏ó‡∏≠‡∏¢‡πÑ‡∏î‡πâ ${val}`);
  // move player
  movePlayer(game.turnIndex, val);
  game.pendingRoll = true;
  // handle tile after slight delay
  setTimeout(()=> handleTile(game.turnIndex), 400);
  return val;
}

function movePlayer(playerIndex, steps){
  let pos = game.positions[playerIndex] ?? 0;
  pos = (pos + steps);
  // if pass finish (>TILE_COUNT-1) count as round complete
  if(pos >= TILE_COUNT){
    // completed a round
    pos = pos % TILE_COUNT;
    game.players[playerIndex].rounds += 1;
    // finish effect: everyone drinks 1
    log(`${game.players[playerIndex].name} ‡∏Ñ‡∏£‡∏ö 1 ‡∏£‡∏≠‡∏ö ‚Äî ‡∏ä‡∏ô‡πÅ‡∏Å‡πâ‡∏ß‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô 1 ‡∏ä‡πá‡∏≠‡∏ï`);
    game.players.forEach(p=>p.shots += 1);
  }
  game.positions[playerIndex] = pos;
  placeAllTokens();
}

function handleTile(playerIndex){
  const pos = game.positions[playerIndex];
  const tile = TILES[pos] || {type:'safe'};
  const player = game.players[playerIndex];

  switch(tile.type){
    case 'drink':
      showModal({
        title:`${player.name} ‡∏ï‡∏Å‡∏ä‡πà‡∏≠‡∏á: ${tile.title}`,
        text: `${tile.desc}\n(‡∏î‡∏∑‡πà‡∏° ${tile.value} ‡∏ä‡πá‡∏≠‡∏ï)`,
        onConfirm: ()=> { player.shots += tile.value; log(`${player.name} ‡∏î‡∏∑‡πà‡∏° ${tile.value} ‡∏ä‡πá‡∏≠‡∏ï`); closeModal(); updateAll(); },
        onSkip: ()=> { log(`${player.name} ‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏î‡∏∑‡πà‡∏°‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ`); closeModal(); }
      });
      break;

    case 'card':
      drawCard(playerIndex);
      break;

    case 'dare':
      showModal({
        title:`${player.name} ‡∏ï‡∏Å‡∏ä‡πà‡∏≠‡∏á: ${tile.title}`,
        text: `${tile.desc}\n(‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ó‡∏≥ ‡∏î‡∏∑‡πà‡∏° ${tile.value} ‡∏ä‡πá‡∏≠‡∏ï)`,
        onConfirm: ()=> { log(`${player.name} ‡∏¢‡∏≠‡∏°: ‡∏î‡∏∑‡πà‡∏° ${tile.value}`); player.shots += tile.value; closeModal(); updateAll(); },
        onSkip: ()=> { log(`${player.name} ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏ó‡∏≥ ‚Äî ‡∏î‡∏∑‡πà‡∏° ${tile.value}`); player.shots += tile.value; closeModal(); updateAll(); }
      });
      break;

    case 'king':
      game.kingIndex = playerIndex;
      log(`${player.name} ‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏¥‡∏á! ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏Ñ‡∏£‡πÉ‡∏´‡πâ‡∏î‡∏∑‡πà‡∏° 1 ‡∏ä‡πá‡∏≠‡∏ï‡πÉ‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ`);
      alert(`${player.name} ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏¥‡∏á! ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏Ñ‡∏£‡πÉ‡∏´‡πâ‡∏î‡∏∑‡πà‡∏° 1 ‡∏ä‡πá‡∏≠‡∏ï ‡πÇ‡∏î‡∏¢‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏° Draw Card -> '‡∏Ñ‡∏¥‡∏á' (‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏±‡πà‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏≤‡∏Å)`); // quick
      break;

    case 'move':
      const steps = tile.value;
      movePlayer(playerIndex, steps);
      log(`${player.name} ‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà ${steps} ‡∏ä‡πà‡∏≠‡∏á`);
      updateAll();
      break;

    case 'roll_again':
      log(`${player.name} ‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ó‡∏≠‡∏¢‡∏ã‡πâ‡∏≥ ‚Äî ‡∏ó‡∏≠‡∏¢‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ`);
      // allow immediate reroll (do not end turn)
      break;

    case 'dice_event':
      // special dice logic
      const d = game.dice;
      if(d%2===0) { player.shots += 2; log(`${player.name} ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏π‡πà ‚Äî ‡∏î‡∏∑‡πà‡∏° 2`); }
      else { // give 2 to others
        game.players.forEach((p, i)=> { if(i!==playerIndex) p.shots += 1; });
        log(`${player.name} ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏µ‡πà ‚Äî ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏î‡πâ 1 ‡∏ä‡πá‡∏≠‡∏ï`);
      }
      updateAll();
      break;

    case 'event':
      log(`${player.name} ‡∏ï‡∏Å‡∏ä‡πà‡∏≠‡∏á event: ${tile.desc}`);
      break;

    case 'safe':
    default:
      log(`${player.name} ‡∏ï‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢`);
      break;
  }
}

/* Cards */
function drawCard(playerIndex){
  if(game.deck.length === 0){
    game.deck = shuffle([...CARDS]);
    log('‡∏™‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡∏°‡πà');
  }
  const c = game.deck.pop();
  log(`${game.players[playerIndex].name} ‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î: ${c.title}`);
  // show modal with action
  showModal({
    title: `‡∏Å‡∏≤‡∏£‡πå‡∏î: ${c.title}`,
    text: c.text,
    onConfirm: ()=> { 
      const res = c.action(game, playerIndex);
      if(res) log(res);
      updateAll();
      closeModal();
    },
    onSkip: ()=> { log(`${game.players[playerIndex].name} ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ô‡∏µ‡πâ`); closeModal(); }
  });
}

/* modal helpers */
function showModal({title, text, onConfirm, onSkip}){
  const m = $('modal');
  $('modalTitle').textContent = title;
  $('modalText').textContent = text;
  m.classList.add('open');
  // attach handlers
  const ok = $('modalConfirm');
  const sk = $('modalSkip');
  ok.onclick = ()=> { if(onConfirm) onConfirm(); };
  sk.onclick = ()=> { if(onSkip) onSkip(); };
}

function closeModal(){
  const m = $('modal');
  m.classList.remove('open');
}

/* turn handling */
function endTurn(){
  if(!game.isStarted) return;
  // if king was set earlier, clear it at end of turn
  if(game.kingIndex === game.turnIndex){
    game.kingIndex = null;
  }
  // advance
  game.turnIndex = (game.turnIndex + 1) % game.players.length;
  updateAll();
  log(`‡∏ñ‡∏∂‡∏á‡∏ï‡∏≤ ${currentPlayer().name}`);
}

/* small UI & events */
document.getElementById('btnStart').addEventListener('click', ()=>{
  const names = $('playerNames').value || '';
  startGameFromNames(names);
});

document.getElementById('btnReset').addEventListener('click', ()=>{
  if(confirm('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) resetGame();
});

document.getElementById('btnRoll').addEventListener('click', ()=>{
  if(!game.isStarted) { alert('‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏Å‡πà‡∏≠‡∏ô'); return; }
  rollDice();
  updateAll();
});

document.getElementById('btnEnd').addEventListener('click', ()=>{
  if(!game.isStarted) return;
  endTurn();
});

document.getElementById('btnDraw').addEventListener('click', ()=>{
  if(!game.isStarted) { alert('‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏Å‡πà‡∏≠‡∏ô'); return; }
  drawCard(game.turnIndex);
  updateAll();
});

document.getElementById('btnRules').addEventListener('click', ()=>{
  alert(
`‡∏Å‡∏é‡∏™‡∏±‡πâ‡∏ô ‡πÜ:
- ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 2-6 ‡∏Ñ‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Start
- ‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤ (Roll) ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
- ‡∏ï‡∏Å‡∏ä‡πà‡∏≠‡∏á‡πÑ‡∏´‡∏ô‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏° ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á
- End Turn ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≤‡∏¢‡∏ï‡∏≤‡πÑ‡∏õ‡∏Ñ‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
- ‡πÉ‡∏Ñ‡∏£‡∏Ñ‡∏£‡∏ö 1 ‡∏£‡∏≠‡∏ö (‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ó‡∏µ‡πà Start) ‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏î‡∏∑‡πà‡∏° 1 ‡∏ä‡πá‡∏≠‡∏ï
Tip: ‡∏õ‡∏£‡∏±‡∏ö‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏ä‡πá‡∏≠‡∏ï‡∏ï‡∏≤‡∏°‡∏ß‡∏á (‡πÅ‡∏ó‡∏ô‡∏ä‡πá‡∏≠‡∏ï‡∏î‡πâ‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡πâ‡∏≤‡πÑ‡∏î‡πâ) ‚Äî ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö!`
  );
});

/* init */
renderBoard();
updateAll();
</script>
</body>
</html>